<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Chasing Shadows</title>

    <link rel="stylesheet" href="css/style.css" media="screen" title="no title" charset="utf-8">
  </head>
  <body>

    <div id="content">

    </div>

    <div id="google_map" style="">

    </div>

    <script type="text/templates" id="form_page">
      <div class="form z1 absolute">
        <div class="row">
        <div class="col-xs-10 col-xs-offset-1 col-md-6 col-md-offset-3">
            <h1>Sign-up</h1>
            <form id="sign_up_form" method="post">

              <div class="form-group">
                <label for="email">Email Address</label>
                <input id="email" class="form-control" type="text" name="email" placeholder="email">
              </div>

              <div class='form-group'>
                <label for="username">Username</label>
                <input id="username" class="form-control" type="text" name="username" placeholder="username">
              </div>

              <div class="form-group">
                <label for="password">Password</label>
                <input id="password" class="form-control" type="text" name="password" placeholder="password">
              </div>

              <input id="submit_button" class="btn btn-default" type="submit" value="Submit">
            </form>
          </div>
        </div>
      </div>
    </script>

    <script type="text/templates" id="welcome_page">
      <div class="welcome absolute z1">
        <h1>Welcome</h1>
        <p>
          Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
        </p>
        <button type="button" name="button" id="gameplay_link">Show Gameplay Page</button>
      </div>
    </script>

    <script type="text/templates" id="gameplay_page">
      <div class="notification absolute z10 bg-danger">
        <span>Some notification</span>
      </div>

      <div class="container-fluid gameplay absolute z1 col-md-12">
        <h1>Gameplay</h1>
        <div>
          Imagine you are David Bowie.  How awesome would that be?

          [The end]

          [Thanks for playing]
        </div>
      </div>
      <div class="attack-container z1 container-fluid">
          <div class="col-md-12 text-center button-margin">
            <button>Attack!</button>
          </div>
        </div>
    </script>

    <script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>

    <script src="scripts/js/user_auth.js"></script>

    <script type="text/javascript">
      $("#google_map").css("height", $(document).height());
      $("#form").css("height", $(document).height());
      $("#welcome_page").css("height", $(document).height());

      $( document ).ready(function() {
        console.log("form loaded");
        $("#content").html($("#form_page").html());
        $('#sign_up_form').submit(function(event) {
          event.preventDefault();
          console.log("It happened");
          var email = $("#email").val().toString();
          var username = $("#username").val().toString();
          var password = $("#password").val().toString();
          // var passwordConfirmation = $("#password_confirmation").val();

          var data = {user: {email: email,
            name: username,
            password: password
          }};

          dataText = "user[email]=" + email + "&user[name]=" + username + "&user[password]=" + password;
          console.log(dataText);

          $.post("http://chasingshadowsapi.herokuapp.com/api/v1/users", dataText, function(data) {
            console.log(data);
            $("#content").html($("#welcome_page").html());
            $("#google_map").css("height", $(document).height());

            $("#gameplay_link").on("touchstart click", function(){
              console.log("button 3 clicked");
              $("#content").html($("#gameplay_page").html());
              initMap();

            });
          });

        });
      });

      var latitude;
var longitude;

function initMap() {
  function drawMap(position){
    var center = position.coords;
    var mapDiv = document.getElementById("google_map");
    var map = new google.maps.Map(mapDiv,
                                { center: {
                                           lat: center.latitude,
                                           lng: center.longitude
                                          },
                                  zoom: 18
                                });
    monitorLocation(map);

    var goldStar = {
     path: 'M 125,5 155,90 245,90 175,145 200,230 125,180 50,230 75,145 5,90 95,90 z',
     fillColor: 'yellow',
     fillOpacity: 0.8,
     scale: 1,
     strokeColor: 'gold',
     strokeWeight: 14
   };

   var knight = {
     url: "https://upload.wikimedia.org/wikipedia/commons/1/1c/Crystal_128_penguin.png",
    //  size: new google.maps.Size(20, 32),
    //  origin: new google.maps.Point(0, 0),
    //  anchor: new google.maps.Point(0, 32)
   };


   var marker = new google.maps.Marker({
     position: map.getCenter(),
     icon: "/img/knight.png",
     map: map
   });

  }

  var locationPromise = getGeoLocationPromise();
  locationPromise.then(function(position) {
    drawMap(position);
  });
}

function monitorLocation(map) {
  navigator.geolocation.watchPosition(updateSuccess, failure, { enableHighAccuracy: true });

  function updateSuccess(position) {
    console.log("UPDATED");
    var newCenter = new google.maps.LatLng(position.coords.latitude,
                                           position.coords.longitude);
    map.panTo(newCenter);

  }

  function failure() {
    console.error("unable to update position");
  }
}


function getGeoLocationPromise() {

  return new Promise(function(fullfill, reject) {
    navigator.geolocation.getCurrentPosition(success, failure);

    function success(position) {
      fullfill(position);
    }

    function failure(){
      reject(new Error("Unable to get position"));
    }

  });
}

    </script>

    <!-- <script src="./scripts/js/map_index.js" type="text/javascript"></script> -->

    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCJxrqPCVCSREKVBPN2XVHXC1hxYZArH78&callback=initMap"></script>

  </body>
</html>
